WITH cte1 AS(SELECT e.name,e.salary,d.name as department FROM Employee e JOIN Department d ON e.departmentId=d.id),
cte2 AS(SELECT department,name,salary,DENSE_RANK() OVER(PARTITION BY department ORDER BY salary desc) AS ra FROM cte1)
SELECT department,name AS employee,salary FROM cte2 WHERE ra<4 ORDER BY department,salary DESC;
