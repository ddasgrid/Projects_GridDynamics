with cte1 as
(select visited_on,sum(amount) as total, row_number() over(order by visited_on) as no from customer group by visited_on order by visited_on),
cte2 as
(select no,visited_on,sum(total) over(order by visited_on rows between 6 preceding and current row) as amount from cte1 )
select visited_on, amount, round(amount/7.0,2) as average_amount from cte2 where no>=7;
